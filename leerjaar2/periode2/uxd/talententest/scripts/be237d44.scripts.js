"use strict";function randomIntFromInterval(e,t){return Math.floor(Math.random()*(t-e+1)+e)}angular.module("talentsApp",["ngSanitize","ngResource","ngRoute"]).config(["$routeProvider","$httpProvider",function(e,t){e.when("/",{templateUrl:"views/index.html",controller:"IndexCtrl"}).when("/register",{templateUrl:"views/register.html",controller:"RegisterCtrl"}).when("/talententest",{templateUrl:"views/talententest.html",controller:"TalententestCtrl",resolve:{talents:["TalentsService",function(e){return e.all().$promise}],userTalents:["UserService",function(e){return e.talents.all().$promise}]}}).when("/talententest/resultaten",{templateUrl:"views/talententest_results.html",controller:"TalententestResultsCtrl",resolve:{talents:["UserService",function(e){return e.talents.all().$promise}]}}).when("/talententest/:talentName",{templateUrl:"views/talententest_quiz.html",controller:"TalententestQuizCtrl",resolve:{talents:["TalentsService",function(e){return e.all().$promise}]}}).when("/vaardigheden",{templateUrl:"views/vaardigheden.html",controller:"VaardighedenCtrl"}).when("/beroepenprofiel",{templateUrl:"views/beroepenprofiel.html",controller:"beroepenProfielCtrl",resolve:{userOccupations:["UserService",function(e){return e.occupations.all().$promise}],userTalents:["UserService",function(e){return e.talents.all().$promise}],userSchooladvice:["UserService",function(e){return e.schooladvice.all().$promise}]}}).when("/mindmap",{templateUrl:"views/mindmap.html",controller:"MindmapCtrl",resolve:{userMindmap:["$http","Config",function(e,t){return e({method:"GET",url:t.API_URL+"user/mindmap"})}]}}).when("/certificaat",{controller:"CertificaatCtrl",templateUrl:"views/certificaat.html",resolve:{certificateInfo:["$http","Config",function(e,t){return e({method:"GET",url:t.API_URL+"user/certificate"})}]}}).otherwise({redirectTo:"/"}),t.interceptors.push("AuthInterceptor")}]).run(["$rootScope","$location","$window","$timeout","Auth","Progress",function(e,t,n,r,i,s){var o=function(){function t(){i(),e.loading=!0,o=setInterval(function(){s++},1)}function n(){var t=0;2e3>s&&(t=2e3-s),r(function(){e.loading=!1},t)}function i(){s=0,o=null}var s=0,o=null;return{start:t,stop:n}}();i.isAuthenticated===!0&&s.nextPage(function(e){return t.path()===e?!1:void t.path(e)}),e.$on("$routeChangeStart",function(e,n){var r=["views/register.html","views/index.html"];-1===r.indexOf(n.templateUrl)&&i.isAuthenticated===!1&&t.path("/"),o.start()}),e.$on("$routeChangeSuccess",function(){o.stop()})}]),angular.module("talentsApp").constant("Config",{API_URL:"http://talententest.projectpaspoort.nl/api/",BASE_URL:"http://talententest.projectpaspoort.nl/"}),angular.module("talentsApp").controller("navigationCtrl",["$scope","$http","$location","Auth","Progress",function(e,t,n,r,i){function s(){for(var t=i.getCurrentLocation(),n=0,r=e.navigation.length;r>n;n++){var s=e.navigation[n];if(s.hasOwnProperty("done")&&s.url!==t&&(s.url=s.done.url),s.url===t)break;s.markedAsDone=!0}}e.navigation=[{url:"/",name:"Inchecken",markedAsDone:!1},{url:"/talententest",name:"talententest",markedAsDone:!1,done:{url:"/talententest/resultaten"}},{url:"/beroepenprofiel",name:"beroepenprofiel",markedAsDone:!1,done:{url:"/beroepenprofiel"}},{url:"/vaardigheden",name:"vaardigheden",markedAsDone:!1},{url:"/mindmap",name:"mindmap",markedAsDone:!1},{url:"/certificaat",name:"certificaat",markedAsDone:!1}],e.navClick=function(e){return r.isAuthenticated===!1?!1:void (e.markedAsDone?e.markedAsDone&&e.hasOwnProperty("done")&&e.done.url&&n.path(e.done.url):n.path(e.url))},i.registerObserver(s)}]),angular.module("talentsApp").controller("IndexCtrl",["$scope","$http","$location","$window","UserService","Progress","Auth","Config",function(e,t,n,r,i,s,o,u){e.login=function(r){var i=e.loginform;return i.$valid?(e.flag=!0,void t({url:u.API_URL+"authenticate",method:"POST",data:r,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(e){var t=e.data;o.isAuthenticated=!0,o.set(t.key),s.nextPage(function(e){n.path(e)})},function(t){e.flag=!1,"wrong_credentials"===t.data&&(i.wrongcredentials=!0)})):!1}}]),angular.module("talentsApp").controller("RegisterCtrl",["$scope","$location","$http","$resource","Config","UserService","Auth","Progress",function(e,t,n,r,i,s,o,u){var a=r(i.API_URL+"schooladvice",{},{all:{method:"GET",isArray:!0,cache:!0}}),f=r(i.API_URL+"schools",{},{all:{method:"GET",isArray:!0,cache:!0}});e.schoolAdvices=[],e.schools=[],a.all(function(t){e.schoolAdvices=t}),f.all(function(t){e.schools=t}),e.register=function(n){if(e.registerForm.$valid){e.flag=!0;var r=new s.user(n);r.$save().then(function(e){o.set(e.key),o.isAuthenticated=!0,u.nextPage(function(e){t.path(e)})}).catch(function(t){"nickname_exists"===t.data&&(e.registerForm.nickname.$error.nameExists=!0)}).finally(function(){e.flag=!1})}}}]),angular.module("talentsApp").controller("TalententestCtrl",["$scope","$location","talents","userTalents",function(e,t,n,r){e.talents=[],angular.forEach(n,function(e){for(var t=0,n=r.length;n>t;t++)r[t].id!==e.id||(e.markAsDone=!0);this.push(e)},e.talents),e.goToQuiz=function(e){return e.markAsDone===!0?!1:void t.path("/talententest/"+e.name)}}]),angular.module("talentsApp").controller("TalententestQuizCtrl",["$scope","$routeParams","$location","$http","Config","Auth","UserService","talents","Progress",function(e,t,n,r,i,s,o,u,a){angular.element(document.getElementById("wrapper")).css("border","none"),e.talent={},angular.forEach(u,function(n){n.name===t.talentName&&(e.talent=n)}),angular.equals({},e.talent)&&n.path("/talententest"),e.answers=[],e.selectRadio=function(t,n){e.answers[t]=n},e.submit=function(){if(e.quiz.$valid===!1)return!1;e.flag=!0;for(var t=0,r=0,i=e.answers.length;i>r;r++)t+=parseInt(e.answers[r],10);var s=new o.talents({name:e.talent.name});s.id=e.talent.id,s.score=t,s.$save(function(){a.nextPage(function(e){n.path(e)})},function(t){400===t.status&&n.path("/talententest"),e.flag=!1})}}]),angular.module("talentsApp").controller("TalententestResultsCtrl",["$scope","$location","$http","$filter","Config","talents","UserService","Progress",function(e,t,n,r,i,s,o,u){function a(){var t=[];return angular.forEach(e.talents,function(e){(e.pivot.picked===!0||1===e.pivot.picked)&&this.push(e)},t),t}angular.forEach(s,function(e){e.pivot.score_int=parseInt(e.pivot.score)});e.talents=s,u.resource.get(function(n){n.talents<8&&t.path("/talententest"),3===n.talentsPicked&&(e.userHasPicked=!0)}),e.toggle=function(){if(e.userHasPicked===!0)return!1;var t=a();3!==t.length||this.talent.pivot.picked||(t[t.length-1].pivot.picked=!1),this.talent.pivot.picked=!this.talent.pivot.picked},e.pickTalents=function(){var n=a();return 3!==n.length?!1:void (e.userHasPicked===!0?u.nextPage(function(e){t.path(e)}):(e.flag=!0,o.talents.save(n,function(){u.nextPage(function(e){t.path(e)})},function(t){e.flag=!1,console.log(t)},function(){e.flag=!1})))}}]),angular.module("talentsApp").controller("VaardighedenCtrl",["$scope","$document","Config","$location","$resource","UserService","Progress",function(e,t,n,r,i,s,o){e.userHasCompleted=!1;var u=i(n.API_URL+"skills",{},{all:{method:"GET",isArray:!0,cache:!0}}),a=new fabric.Canvas("vaardigheden-canvas"),f=document.querySelector(".overlay");a.setWidth(f.offsetWidth),a.setHeight(f.offsetHeight),a.selection=!1;var l=[],c=new fabric.Rect({width:19,height:378,left:468,top:57,fill:"transparent",angle:353});c.selectable=!1,a.add(c),u.all(function(e){angular.forEach(e,function(e,t){var n=t%2?"left":"right",r=this;fabric.Image.fromURL("/images/tree_board_"+n+".png",function(t){var i=new fabric.Text(e.name.substring(0,1).toUpperCase()+e.name.substring(1),{fontFamily:"candelabook",fontSize:18,fill:"#FFFFFF"});switch(n){case"left":i.set("top",7),i.set("left",48);break;case"right":i.set("top",5),i.set("left",25)}var s=new fabric.Group([t,i],{left:randomIntFromInterval(0,380),top:randomIntFromInterval(100,410),angle:randomIntFromInterval(-6,6)});s.hasControls=!1,s.hasBorders=!1,s.hoverCursor="pointer",s._originalObject=e,r.push(s),a.add(s)})},l)}),e.pickSkills=function(){e.flag=!0;var t=[];if(angular.forEach(l,function(e){c.intersectsWithObject(e)&&this.push(e._originalObject)},t),t.length>=5){var n=new s.skills(t);n.$save().then(function(){o.nextPage(function(e){r.path(e)})}).catch(function(){e.flag=!1}).finally(function(){})}}}]),angular.module("talentsApp").controller("beroepenProfielCtrl",["$scope","$routeParams","$location","$route","$sce","userTalents","userOccupations","userSchooladvice",function(e,t,n,r,i,s,o,u){function a(e,t){switch(("vmbo-t"===e||"vmbo-k"===e||"vmbo-b"===e||"vmbo-gl"===e)&&(e="vmbo"),e){case"vmbo":switch(t){case"mbo":return["basisschool","vmbo","mbo"];case"hbo":return["vmbo","havo","hbo"];case"wo":return["vmbo","havo","vwo","wo"]}break;case"havo":switch(t){case"mbo":return["basisschool","havo","mbo"];case"hbo":return["basisschool","havo","hbo"];case"wo":return["havo","vwo","wo"]}break;case"vwo":switch(t){case"mbo":return["basisschool","vwo","mbo"];case"hbo":return["bassischool","vwo","hbo"];case"wo":return["basischool","vwo","wo"]}}}function f(e,t){e=e.split(" / ");var n=[];return angular.forEach(e,function(e){this.push(a(e,t))},n),n}e.talents=s,e.jobs=[],e.activeJob={},angular.forEach(o,function(e){e.route=f(u.name,e.education_level.name),e.currentroute=0,e.youtube=i.trustAsResourceUrl("//www.youtube.com/embed/"+e.youtube),this.push(e)},e.jobs),e.toggleRoute=function(){e.activeJob.currentroute=0===e.activeJob.currentroute?1:0},e.isActive=function(t){return t===e.activeJob.id},e.setActiveJob=function(t){e.activeJob=t},e.setActiveJob(e.jobs[0]),e.next=function(){n.path("/vaardigheden")}}]);var Paint=function(){function e(e){c=e,c.observe("mouse:down",function(e){u(e)}),c.observe("mouse:move",function(e){a(e)}),c.observe("mouse:up",function(e){f(e)}),c.freeDrawingBrush=new fabric.PencilBrush(c),d.addEventListener("change",i),t(),l(p)}function t(e){c.freeDrawingBrush.width=e||1,c.freeDrawingBrush.shadowBlur=0,n(!0)}function n(e){c.isDrawingMode=e,c.renderAll(),c.calcOffset()}function r(){var e=prompt("Schrijf hier je tekst!","Ik"),t=20,n=p,r=new fabric.Text(e,{left:c.width/2+30,top:c.height/2,fontFamily:"candelabook",fontSize:t,fill:n});c.add(r),s("pointer"),c.setActiveObject(r)}function i(e){var t=new FileReader;t.onload=function(e){var t=new Image;t.onload=function(){var e=new fabric.Image(t,{left:c.width/2-t.width/2,top:c.height/2-t.height/2});c.add(e),s("pointer"),c.setActiveObject(e)},t.src=e.target.result},t.readAsDataURL(e.target.files[0])}function s(e){switch(e){case"pencil":t();break;case"brush":t(10);break;case"pointer":n(!1);break;case"type":r();break;case"image":d.click();break;case"delete":o();break;default:t()}}function o(){var e=c.getActiveObject(),t=c.getActiveGroup();e&&c.remove(e),t&&(t.forEachObject(function(e){c.remove(e)}),c.discardActiveGroup().renderAll())}function u(e){c.getPointer(e.e);h=!0,c.off("mouse:down")}function a(){return h?void c.off("mouse:move"):!1}function f(){h&&(h=!1,c.off("mouse:up"))}function l(e){p=e,c.freeDrawingBrush.color=p}var c,h=!1,p="#CCC",d=angular.element('<input type="file" name="imageInput" />')[0];return{init:e,setColour:l,switchTool:s}}();angular.module("talentsApp").controller("MindmapCtrl",["$scope","$http","$location","Config","Progress","userMindmap",function(e,t,n,r,i,s){var o=document.getElementById("wrapper");if(angular.element(o).css("padding",0),e.existingMindmapDrawing=!1,s.data)e.existingMindmapDrawing=s.data;else{e.tools=[{name:"pointer"},{name:"brush"},{name:"pencil"},{name:"type"},{name:"image"},{name:"delete"}],e.colors=["#4194e1","#343434","#eeec39","#67e13d","#e03535"],e.activeTool="pencil";var u=new fabric.Canvas("mindmap-canvas",{});u.setWidth(o.offsetWidth),u.setHeight(o.offsetHeight),u.setBackgroundImage("/images/mindmap_bg.png",u.renderAll.bind(u),{left:u.width/2-139,top:0,originX:"left",originY:"top"}),Paint.init(u),Paint.setColour(e.colors[0]),e.setDrawingColor=function(e){Paint.setColour(e)},e.switchTool=function(t){Paint.switchTool(t),e.activeTool=t},e.finish=function(){e.flag=!0;var s=u.toDataURL("image/png");t({url:r.API_URL+"user/mindmap",method:"POST",data:s}).then(function(){i.nextPage(function(e){n.path(e)})},function(){e.flag=!1})}}}]),angular.module("talentsApp").controller("CertificaatCtrl",["$scope","$location","$sce","certificateInfo","Auth","Config",function(e,t,n,r,i,s,o){var u=s.BASE_URL+"pdf/index.php";u+="?user="+r.data.nickname,u+="&school="+r.data.school,u+="&talent[]="+r.data.talents[0].name,u+="&talent[]="+r.data.talents[1].name,u+="&talent[]="+r.data.talents[2].name,angular.forEach(r.data.skills,function(e){u+="&skill[]="+e.name}),u+="&mindmap="+i.get(),e.download=function(){e.downloadurl=n.trustAsResourceUrl(u)}}]),angular.module("talentsApp").controller("headerButtonCtrl",["$scope","$window","Auth",function(e,t,n){e.logout=function(){n.remove(),t.location.reload()}}]),angular.module("talentsApp").factory("AuthInterceptor",["$window","$q","$location","Auth",function(e,t,n,r){return{request:function(e){return e.headers=e.headers||{},r.get()&&(e.headers.Authorization="Token "+r.get()),e||t.when(e)},response:function(e){return e||t.when(e)},responseError:function(e){return 401===e.status&&(n.path("/"),r.remove()),t.reject(e)}}}]),angular.module("talentsApp").factory("UserService",["$resource","Config",function(e,t){return{user:e(t.API_URL+"user",{},{}),talents:e(t.API_URL+"user/talent/:name",{name:"@name"},{all:{method:"GET",isArray:!0}},{add:{method:"POST",isArray:!1}}),skills:e(t.API_URL+"user/skills",{},{all:{method:"GET",isArray:!0}}),occupations:e(t.API_URL+"user/occupation",{},{all:{method:"GET",cache:!0,isArray:!0}}),schooladvice:e(t.API_URL+"user/schooladvice",{},{all:{method:"GET",isArray:!1}})}}]),angular.module("talentsApp").factory("TalentsService",["$window","$location","$http","$resource","Config",function(e,t,n,r,i){return r(i.API_URL+"talent/:name",{name:"@name"},{all:{method:"GET",isArray:!0,cache:!0}})}]),angular.module("talentsApp").service("Progress",["$resource","Config",function(e,t){function n(){angular.forEach(a,function(e){e()})}function r(e){a.push(e)}function i(e){o.get(function(t){var r="/talententest";8===t.talents&&(r="/talententest/resultaten"),t.talentsPicked>0&&(r="/beroepenprofiel"),t.skills>0&&(r="/mindmap"),t.mindmap>0&&(r="/certificaat"),u=r,n(),e(r)})}function s(){return u}var o=e(t.API_URL+"user/progress",{},{get:{method:"GET",isArray:!1,cache:!1}}),u="",a=[];return{registerObserver:r,getCurrentLocation:s,resource:o,nextPage:i}}]),angular.module("talentsApp").service("Auth",["$window",function(e){var t=null||e.sessionStorage.getItem("token"),n=t?!0:!1;return{isAuthenticated:n,token:t,set:function(r){t=r||t,e.sessionStorage.setItem("token",t),n=!0},get:function(){return t},remove:function(){t=null,e.sessionStorage.removeItem("token"),n=!1}}}])