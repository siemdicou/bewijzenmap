"use strict";function randomIntFromInterval(a,b){return Math.floor(Math.random()*(b-a+1)+a)}angular.module("talentsApp",["ngSanitize","ngResource","ngRoute"]).config(["$routeProvider","$httpProvider",function(a,b){a.when("/",{templateUrl:"views/index.html",controller:"IndexCtrl"}).when("/register",{templateUrl:"views/register.html",controller:"RegisterCtrl"}).when("/talententest",{templateUrl:"views/talententest.html",controller:"TalententestCtrl",resolve:{talents:["TalentsService",function(a){return a.all().$promise}],userTalents:["UserService",function(a){return a.talents.all().$promise}]}}).when("/talententest/resultaten",{templateUrl:"views/talententest_results.html",controller:"TalententestResultsCtrl",resolve:{talents:["UserService",function(a){return a.talents.all().$promise}]}}).when("/talententest/:talentName",{templateUrl:"views/talententest_quiz.html",controller:"TalententestQuizCtrl",resolve:{talents:["TalentsService",function(a){return a.all().$promise}]}}).when("/vaardigheden",{templateUrl:"views/vaardigheden.html",controller:"VaardighedenCtrl"}).when("/beroepenprofiel",{templateUrl:"views/beroepenprofiel.html",controller:"beroepenProfielCtrl",resolve:{userOccupations:["UserService",function(a){return a.occupations.all().$promise}],userTalents:["UserService",function(a){return a.talents.all().$promise}],userSchooladvice:["UserService",function(a){return a.schooladvice.all().$promise}]}}).when("/mindmap",{templateUrl:"views/mindmap.html",controller:"MindmapCtrl",resolve:{userMindmap:["$http","Config",function(a,b){return a({method:"GET",url:b.API_URL+"user/mindmap"})}]}}).when("/certificaat",{controller:"CertificaatCtrl",templateUrl:"views/certificaat.html",resolve:{certificateInfo:["$http","Config",function(a,b){return a({method:"GET",url:b.API_URL+"user/certificate"})}]}}).otherwise({redirectTo:"/"}),b.interceptors.push("AuthInterceptor")}]).run(["$rootScope","$location","$window","$timeout","Auth","Progress",function(a,b,c,d,e,f){var g=function(){function b(){e(),a.loading=!0,g=setInterval(function(){f++},1)}function c(){var b=0;2e3>f&&(b=2e3-f),d(function(){a.loading=!1},b)}function e(){f=0,g=null}var f=0,g=null;return{start:b,stop:c}}();e.isAuthenticated===!0&&f.nextPage(function(a){return b.path()===a?!1:void b.path(a)}),a.$on("$routeChangeStart",function(a,c){var d=["views/register.html","views/index.html"];-1===d.indexOf(c.templateUrl)&&e.isAuthenticated===!1&&b.path("/"),g.start()}),a.$on("$routeChangeSuccess",function(){g.stop()})}]),angular.module("talentsApp").constant("Config",{API_URL:"http://talententest.projectpaspoort.nl/api/",BASE_URL:"http://talententest.projectpaspoort.nl/"}),angular.module("talentsApp").controller("navigationCtrl",["$scope","$http","$location","Auth","Progress",function(a,b,c,d,e){function f(){for(var b=e.getCurrentLocation(),c=0,d=a.navigation.length;d>c;c++){var f=a.navigation[c];if(f.hasOwnProperty("done")&&f.url!==b&&(f.url=f.done.url),f.url===b)break;f.markedAsDone=!0}}a.navigation=[{url:"/",name:"Inchecken",markedAsDone:!1},{url:"/talententest",name:"talententest",markedAsDone:!1,done:{url:"/talententest/resultaten"}},{url:"/beroepenprofiel",name:"beroepenprofiel",markedAsDone:!1,done:{url:"/beroepenprofiel"}},{url:"/vaardigheden",name:"vaardigheden",markedAsDone:!1},{url:"/mindmap",name:"mindmap",markedAsDone:!1},{url:"/certificaat",name:"certificaat",markedAsDone:!1}],a.navClick=function(a){return d.isAuthenticated===!1?!1:void(a.markedAsDone?a.markedAsDone&&a.hasOwnProperty("done")&&a.done.url&&c.path(a.done.url):c.path(a.url))},e.registerObserver(f)}]),angular.module("talentsApp").controller("IndexCtrl",["$scope","$http","$location","$window","UserService","Progress","Auth","Config",function(a,b,c,d,e,f,g,h){a.login=function(d){var e=a.loginform;return e.$valid?(a.flag=!0,void b({url:h.API_URL+"authenticate",method:"POST",data:d,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(a){var b=a.data;g.isAuthenticated=!0,g.set(b.key),f.nextPage(function(a){c.path(a)})},function(b){a.flag=!1,"wrong_credentials"===b.data&&(e.wrongcredentials=!0)})):!1}}]),angular.module("talentsApp").controller("RegisterCtrl",["$scope","$location","$http","$resource","Config","UserService","Auth","Progress",function(a,b,c,d,e,f,g,h){var i=d(e.API_URL+"schooladvice",{},{all:{method:"GET",isArray:!0,cache:!0}}),j=d(e.API_URL+"schools",{},{all:{method:"GET",isArray:!0,cache:!0}});a.schoolAdvices=[],a.schools=[],i.all(function(b){a.schoolAdvices=b}),j.all(function(b){a.schools=b}),a.register=function(c){if(a.registerForm.$valid){a.flag=!0;var d=new f.user(c);d.$save().then(function(a){g.set(a.key),g.isAuthenticated=!0,h.nextPage(function(a){b.path(a)})}).catch(function(b){"nickname_exists"===b.data&&(a.registerForm.nickname.$error.nameExists=!0)}).finally(function(){a.flag=!1})}}}]),angular.module("talentsApp").controller("TalententestCtrl",["$scope","$location","talents","userTalents",function(a,b,c,d){a.talents=[],angular.forEach(c,function(a){for(var b=0,c=d.length;c>b;b++)d[b].id!==a.id||(a.markAsDone=!0);this.push(a)},a.talents),a.goToQuiz=function(a){return a.markAsDone===!0?!1:void b.path("/talententest/"+a.name)}}]),angular.module("talentsApp").controller("TalententestQuizCtrl",["$scope","$routeParams","$location","$http","Config","Auth","UserService","talents","Progress",function(a,b,c,d,e,f,g,h,i){angular.element(document.getElementById("wrapper")).css("border","none"),a.talent={},angular.forEach(h,function(c){c.name===b.talentName&&(a.talent=c)}),angular.equals({},a.talent)&&c.path("/talententest"),a.answers=[],a.selectRadio=function(b,c){a.answers[b]=c},a.submit=function(){if(a.quiz.$valid===!1)return!1;a.flag=!0;for(var b=0,d=0,e=a.answers.length;e>d;d++)b+=parseInt(a.answers[d],10);var f=new g.talents({name:a.talent.name});f.id=a.talent.id,f.score=b,f.$save(function(){i.nextPage(function(a){c.path(a)})},function(b){400===b.status&&c.path("/talententest"),a.flag=!1})}}]),angular.module("talentsApp").controller("TalententestResultsCtrl",["$scope","$location","$http","$filter","Config","talents","UserService","Progress",function(a,b,c,d,e,f,g,h){function i(){var b=[];return angular.forEach(a.talents,function(a){(a.pivot.picked===!0||1===a.pivot.picked)&&this.push(a)},b),b}a.talents=f,h.resource.get(function(c){c.talents<8&&b.path("/talententest"),3===c.talentsPicked&&(a.userHasPicked=!0)}),a.toggle=function(){if(a.userHasPicked===!0)return!1;var b=i();3!==b.length||this.talent.pivot.picked||(b[b.length-1].pivot.picked=!1),this.talent.pivot.picked=!this.talent.pivot.picked},a.pickTalents=function(){var c=i();return 3!==c.length?!1:void(a.userHasPicked===!0?h.nextPage(function(a){b.path(a)}):(a.flag=!0,g.talents.save(c,function(){h.nextPage(function(a){b.path(a)})},function(b){a.flag=!1,console.log(b)},function(){a.flag=!1})))}}]),angular.module("talentsApp").controller("VaardighedenCtrl",["$scope","$document","Config","$location","$resource","UserService","Progress",function(a,b,c,d,e,f,g){a.userHasCompleted=!1;var h=e(c.API_URL+"skills",{},{all:{method:"GET",isArray:!0,cache:!0}}),i=new fabric.Canvas("vaardigheden-canvas"),j=document.querySelector(".overlay");i.setWidth(j.offsetWidth),i.setHeight(j.offsetHeight),i.selection=!1;var k=[],l=new fabric.Rect({width:19,height:378,left:468,top:57,fill:"transparent",angle:353});l.selectable=!1,i.add(l),h.all(function(a){angular.forEach(a,function(a,b){var c=b%2?"left":"right",d=this;fabric.Image.fromURL("/images/tree_board_"+c+".png",function(b){var e=new fabric.Text(a.name.substring(0,1).toUpperCase()+a.name.substring(1),{fontFamily:"candelabook",fontSize:18,fill:"#FFFFFF"});switch(c){case"left":e.set("top",7),e.set("left",48);break;case"right":e.set("top",5),e.set("left",25)}var f=new fabric.Group([b,e],{left:randomIntFromInterval(0,380),top:randomIntFromInterval(100,410),angle:randomIntFromInterval(-6,6)});f.hasControls=!1,f.hasBorders=!1,f.hoverCursor="pointer",f._originalObject=a,d.push(f),i.add(f)})},k)}),a.pickSkills=function(){a.flag=!0;var b=[];if(angular.forEach(k,function(a){l.intersectsWithObject(a)&&this.push(a._originalObject)},b),5===b.length){var c=new f.skills(b);c.$save().then(function(){g.nextPage(function(a){d.path(a)})}).catch(function(){a.flag=!1}).finally(function(){})}}}]),angular.module("talentsApp").controller("beroepenProfielCtrl",["$scope","$routeParams","$location","$route","$sce","userTalents","userOccupations","userSchooladvice",function(a,b,c,d,e,f,g,h){function i(a,b){switch(("vmbo-t"===a||"vmbo-k"===a||"vmbo-b"===a||"vmbo-gl"===a)&&(a="vmbo"),a){case"vmbo":switch(b){case"mbo":return["basisschool","vmbo","mbo"];case"hbo":return["vmbo","havo","hbo"];case"wo":return["vmbo","havo","vwo","wo"]}break;case"havo":switch(b){case"mbo":return["basisschool","havo","mbo"];case"hbo":return["basisschool","havo","hbo"];case"wo":return["havo","vwo","wo"]}break;case"vwo":switch(b){case"mbo":return["basisschool","vwo","mbo"];case"hbo":return["bassischool","vwo","hbo"];case"wo":return["basischool","vwo","wo"]}}}function j(a,b){a=a.split(" / ");var c=[];return angular.forEach(a,function(a){this.push(i(a,b))},c),c}a.talents=f,a.jobs=[],a.activeJob={},angular.forEach(g,function(a){a.route=j(h.name,a.education_level.name),a.currentroute=0,a.youtube=e.trustAsResourceUrl("//www.youtube.com/embed/"+a.youtube),this.push(a)},a.jobs),a.toggleRoute=function(){a.activeJob.currentroute=0===a.activeJob.currentroute?1:0},a.isActive=function(b){return b===a.activeJob.id},a.setActiveJob=function(b){a.activeJob=b},a.setActiveJob(a.jobs[0]),a.next=function(){c.path("/vaardigheden")}}]);var Paint=function(){function a(a){l=a,l.observe("mouse:down",function(a){h(a)}),l.observe("mouse:move",function(a){i(a)}),l.observe("mouse:up",function(a){j(a)}),l.freeDrawingBrush=new fabric.PencilBrush(l),o.addEventListener("change",e),b(),k(n)}function b(a){l.freeDrawingBrush.width=a||1,l.freeDrawingBrush.shadowBlur=0,c(!0)}function c(a){l.isDrawingMode=a,l.renderAll(),l.calcOffset()}function d(){var a=prompt("Schrijf hier je tekst!","Ik"),b=20,c=n,d=new fabric.Text(a,{left:l.width/2+30,top:l.height/2,fontFamily:"candelabook",fontSize:b,fill:c});l.add(d),f("pointer"),l.setActiveObject(d)}function e(a){var b=new FileReader;b.onload=function(a){var b=new Image;b.onload=function(){var a=new fabric.Image(b,{left:l.width/2-b.width/2,top:l.height/2-b.height/2});l.add(a),f("pointer"),l.setActiveObject(a)},b.src=a.target.result},b.readAsDataURL(a.target.files[0])}function f(a){switch(a){case"pencil":b();break;case"brush":b(10);break;case"pointer":c(!1);break;case"type":d();break;case"image":o.click();break;case"delete":g();break;default:b()}}function g(){var a=l.getActiveObject(),b=l.getActiveGroup();a&&l.remove(a),b&&(b.forEachObject(function(a){l.remove(a)}),l.discardActiveGroup().renderAll())}function h(a){l.getPointer(a.e);m=!0,l.off("mouse:down")}function i(){return m?void l.off("mouse:move"):!1}function j(){m&&(m=!1,l.off("mouse:up"))}function k(a){n=a,l.freeDrawingBrush.color=n}var l,m=!1,n="#CCC",o=angular.element('<input type="file" name="imageInput" />')[0];return{init:a,setColour:k,switchTool:f}}();angular.module("talentsApp").controller("MindmapCtrl",["$scope","$http","$location","Config","Progress","userMindmap",function(a,b,c,d,e,f){var g=document.getElementById("wrapper");if(angular.element(g).css("padding",0),a.existingMindmapDrawing=!1,f.data)a.existingMindmapDrawing=f.data;else{a.tools=[{name:"pointer"},{name:"brush"},{name:"pencil"},{name:"type"},{name:"image"},{name:"delete"}],a.colors=["#4194e1","#343434","#eeec39","#67e13d","#e03535"],a.activeTool="pencil";var h=new fabric.Canvas("mindmap-canvas",{});h.setWidth(g.offsetWidth),h.setHeight(g.offsetHeight),h.setBackgroundImage("/images/mindmap_bg.png",h.renderAll.bind(h),{left:h.width/2-139,top:0,originX:"left",originY:"top"}),Paint.init(h),Paint.setColour(a.colors[0]),a.setDrawingColor=function(a){Paint.setColour(a)},a.switchTool=function(b){Paint.switchTool(b),a.activeTool=b},a.finish=function(){a.flag=!0;var f=h.toDataURL("image/png");b({url:d.API_URL+"user/mindmap",method:"POST",data:f}).then(function(){e.nextPage(function(a){c.path(a)})},function(){a.flag=!1})}}}]),angular.module("talentsApp").controller("CertificaatCtrl",["$scope","$location","$sce","certificateInfo","Auth","Config",function(a,b,c,d,e,f){console.log(d);var g=f.BASE_URL+"pdf/index.php";g+="?user="+d.data.nickname,g+="&school="+d.data.school,g+="&talent[]="+d.data.talents[0].name,g+="&talent[]="+d.data.talents[1].name,g+="&talent[]="+d.data.talents[2].name,angular.forEach(d.data.skills,function(a){g+="&skill[]="+a.name}),g+="&mindmap="+e.get(),a.download=function(){a.downloadurl=c.trustAsResourceUrl(g)}}]),angular.module("talentsApp").controller("headerButtonCtrl",["$scope","$window","Auth",function(a,b,c){a.logout=function(){c.remove(),b.location.reload()}}]),angular.module("talentsApp").factory("AuthInterceptor",["$window","$q","$location","Auth",function(a,b,c,d){return{request:function(a){return a.headers=a.headers||{},d.get()&&(a.headers.Authorization="Token "+d.get()),a||b.when(a)},response:function(a){return a||b.when(a)},responseError:function(a){return 401===a.status&&(c.path("/"),d.remove()),b.reject(a)}}}]),angular.module("talentsApp").factory("UserService",["$resource","Config",function(a,b){return{user:a(b.API_URL+"user",{},{}),talents:a(b.API_URL+"user/talent/:name",{name:"@name"},{all:{method:"GET",isArray:!0}},{add:{method:"POST",isArray:!1}}),skills:a(b.API_URL+"user/skills",{},{all:{method:"GET",isArray:!0}}),occupations:a(b.API_URL+"user/occupation",{},{all:{method:"GET",cache:!0,isArray:!0}}),schooladvice:a(b.API_URL+"user/schooladvice",{},{all:{method:"GET",cache:!0,isArray:!1}})}}]),angular.module("talentsApp").factory("TalentsService",["$window","$location","$http","$resource","Config",function(a,b,c,d,e){return d(e.API_URL+"talent/:name",{name:"@name"},{all:{method:"GET",isArray:!0,cache:!0}})}]),angular.module("talentsApp").service("Progress",["$resource","Config",function(a,b){function c(){angular.forEach(i,function(a){a()})}function d(a){i.push(a)}function e(a){g.get(function(b){var d="/talententest";8===b.talents&&(d="/talententest/resultaten"),b.talentsPicked>0&&(d="/beroepenprofiel"),b.skills>0&&(d="/mindmap"),b.mindmap>0&&(d="/certificaat"),h=d,c(),a(d)})}function f(){return h}var g=a(b.API_URL+"user/progress",{},{get:{method:"GET",isArray:!1,cache:!1}}),h="",i=[];return{registerObserver:d,getCurrentLocation:f,resource:g,nextPage:e}}]),angular.module("talentsApp").service("Auth",["$window",function(a){var b=null||a.sessionStorage.getItem("token"),c=b?!0:!1;return{isAuthenticated:c,token:b,set:function(d){b=d||b,a.sessionStorage.setItem("token",b),c=!0},get:function(){return b},remove:function(){b=null,a.sessionStorage.removeItem("token"),c=!1}}}]);